import React from 'react';
import { HuffmanTree } from "../huffman";
import ReactDOM from 'react-dom';
import { Zlib } from './zlib'

// const stream = '789c5553490edb300cfc0a1f60f80f45d15b37a0e80318897158687128d1e8f33b929da63d3956c4e16cfe5c4d32e9de3c53aca91a35edc459fa42a19626a14b77238eba6b0b5a3692a47da51f12a9d5c8491a250ede4836e9943080df5aba58f4bc9077bae94d0a5e084000214fdd34485be9fb839ba48481430f31632ada940e49147d3c1f1a3c3105b7e6b8ff21e9d33963714a1ab47bd442a51692a2999e0ef02679175be9ab270c9e6fd4b5048d5e3a550b0a76c427d24a5fd80d63356aa534cc58e801b626061f40be9ffc78a1bb5896d2a1638760317ea97df3c2d1ffe752840b45dda0ab81e25c03d4ac00ce3b80ab153659e95357004c0fc1673872895fc8bc1bb64e7658b1501ef21bfdf2d6eb4a1f8d1bedd57ad78efc2edcccadf120f4c259e967278dffdc6484b4101622e8a89736b6e06f41af58c6559286ddd3e4834d47e2bf49eef719848d185eae8f440e482fdc713949bdfec8f0d0379d12263dd0e1103c379804129b83cf5592e9d4e169f7ced8dd785729b34e6f01e7212cafede495d034ab7f7d177fc577373457d370f3ecd26c31f62fb0f506400c17bd3ddeca678e474dde7746ddbf8dde5cb221ab3e5d689f026f030c89f2c81851230b368800339c5618d7168cb430bf23d338d21801a1207f005f1a49c2';
//const stream = '789ccb48cdc9c95728cf2fca4901001a0b045d'
const stream = '789CB55D5B8EE44692FCAF53F000445D60BF06A35DA081995E0D06B5FFEC4C763517F9286592853AFE86BB99B97B30BB2560A5063418A932930C46F8C3DCFCC17F5C6FF37958DEEEDB79385E4FD7DB705FD6613ACFEB381CAE97FB7C58E775BB0DD371795BEE87E5F23ACCA7657D1EFE39CD87F932DD87FB613ECDB7E5FEDB360F87ED76DFEEC3BB7D65D8D6E1ED7ADFE6DBFC3C7CDE4EA7E93CBC7D9B6EF37A9B86DBB6DEDA1D7FDBA673FBB07D329D9676817558AFB7F6CF301D86B6847629FFDDE17A7B9B6FC3E9FAA57DBADC6389C3BC0D97E5BE3C0F9F2EC37D7A5D56FF54FF82A79A86E5DC7E7D5CE6B6EAFFBE1D96E17DBA2DEDD29769BDDAA2DFDA63ACCB97F69776C5F3F4DAAE381CDBFFDEA65B7BF265BEB4BF5E2FEB7C1FDB4FDAD3DA76DC96E372D84EED37E7EDFE3CFCCFF23EB57F194E53DBA1651AAE769B76B5B7ED667FDD0EED51C6615ABBC769D779B3E5CEB63C6ED1F0B55DE1E48F84FFC6996CB7CBC4F3685BD69EFBD5B6AAFDB07D66FF3EE6DEB44FBFB6ED6F8BFA753E9D665BB73DE46F5BFBAC5DE0B5FDFB71B15DFFD43E7A6DCBF8365F8EB776805AEDFBB24E73DBC4B7F6E4FCC5C83F7E9DB7D7A5DDA02D7998BF7E5D0E4B7B069EDFC1BEFB3E9DDAAD7D13271391B67DED182EC3715B7C4F9E875FAE97F9608BE441DB933D0FFFDEEEED14DAA6DFE761390E535B1A6F796EC735DFED784E26A18B9DCE7D393F3F3DFDFDD6846F6D37584D7270CFE172BDB87CC67EB45D1FEED7E3749ADB39B8AC6B87EF4586DF97F7F9D6C4F2AD1DE07C6BABC3B6DBD5B653BBC7616EDFFEDB7C99A78BADCF9EBFC9F870D92E87B27F4D24D6ADEDECAFB769BE9BD8F4BB8643BCCFC7B6D68FC5C4E5B27CF9D61EBEFD45E2FFF5D6346CB183C701B8D0E8EBB6B2B60CFB6ADB715FE7FBF5B4AD6FF667888BAD4A72F131FA039CAF7E26D8686CFFFBFCCDA477D2675088BC743B31ED48DBDF2D9FFDF6ED7A39848C4CB7C3E6CFA3EBB91EBAF4F9698FC35BD3F6A59D5B3305D3E1B09DEFED1A90D7946513E78F9DB4F277238DC072E9142744AF3DE06C5F37F1D239F973B71FACCBE5B01CB7CBEAE2DEFEAA87752987D09E21A0A7E5B52D7E4CC930BBD284AE5D668C1D1EDA3E1C9A0D6CABBD40FEB6DBF4C556513EF9D8DF36FF334E36F4C2951832F9DEB6D78C5013D7B64A937713E8FB7D6A3B37A654BA41D321B6335E275FA60BEB0815FFB27C69F268666F3355975CB5534A2B552DB62B8B49CDFF6EF7F54A116E76AC2DCBEC256E25B3964F83E36DAA10B6B5EDE297F9762DEA100FF53CFC57DB21DA205DCBEFF73CB816E7C6C35436D9BEDEE54C280B3CB105FB3286946FD56C8DDDB3E552E0B2B08A3427A33B0F6858DBF46D3A4E2997A39DA67FFEB69DDE97CB74738DE3369F27BA1AB792ED6B2793B96617C2D5995EF8E6CAE78D7A203F4ABBD2D7F9766E22BFD963C556CB8E7F9DB6039CD2695EBEB62769E797865026416A6AAA68DA00B1581733AD6BD328579EB59DD0E6162BAD3E36ED7A5CAEE3706C4FF1056AD64E67BB1708D0BE7B5FED8462A96E849E9EAAC50ED5A363E5AEF8BEAE7EFE65E5CD14D85DDBC12DF7F3F518BB02456806CB6CC3B97D72E503347DB9DEBE2CE58CEEA6C866008EE65AB0789DAE0BA2A973B3FBA7F99A42580C79D867DBAF76CA4D869A5C0536910AD917AFED0EA97EDA49178B6DD533741A3906EC88DF85DA8CD5EB0DAFB7E97D698F23F3637728DAE40F7171ABFE566DA31DF5F3F0AF0D324E35E026E23C4D9DC346E212EDC47E71B95D5C584741011872ECFD722C30A2EA11165DF64D56C51F039F0A225CDB9F6E339D406CE9BC55ABE712A5FF771F1A800EB8304D159769CA048306B59A218C120D7D0B72D72EE39E89BA31C64687DBB55BF2FECFC3CBAADFBBBAC652CCC9DBEE1A72F3D3A52FF36B7F394D4DF8D79DDBFA660E6172BC68CB4A70D2766D866133A15B053525D05FDB0DEF06A10809636D90AB589290044D602E5588F7E47701A490B48E0E335C28685D635D23816A736892651886726DBA02582DB85B431540EE3C5353343A7C007EF8366E92FBB0B01171615C015A2B98E9CBC9B881EE68040AA1CDD242EDB4DCD3C73D3FF024052FCA58B5ED28C84AEEDAC57E778434ECF9A09064496B589B4F1782702AB43FDE623142384B7C02B8A335C249EA6003CEC2E13501605C2497D32363DA179906938CA2A5148ED137565F0A3800DFE5E06F3BBD6DEBB4125B9BCCB74DF407963B6EEB377FE00846E619F2AB875B9A9F380142BB04A4AB8D3B86CB103645A043A081F52C476DB89F9C0CFF72DC8B3015A3ED90DC61E7C7B53A409074566EFB4633F072947070678FCE00BFBBE30F31E515E9D178960AE4FCE4B905D86E06714F4F84E16E0B5D6528649073452208022C60D1BA42E50DE504E66CEB74B86100B7F37A2588491C6AE22AD38CFDF585CAFC99D973735740A90BB749458902E9B69A9032663C2EDCCE881BA08F7EF50653DC3940A253CB646C03BEB96801D4C24DC5493685A76572F71FBA641F20568599B7E7C39DDD98E184283FB9EAAA3106DBB9E5083F3F9BE9975DC2623C64BC579C669E5D6BF3D355ECF23CFCE76A3A51801B9F928B3134AA853C3DBD20B831D58EF31A8BD9F730D78377D9588B2C867FFC7F2919856F8979ECF9E1143BE9C9E7A166F23B0C39D368D8011B0C9E0F63B96A6C0E8C8C8E27DC3237167BE2B8A62E1B32578CB44938C5238F9E2E59782460351D87ED3495328DA8C00344B1188ACEAFE3BFE831C7D0F0D009402E3989421240D2017A4C681258337CFEB9584090282CC67D7595867993C5F0A70B23B06933FC7F0E03C0AAC06A073E0B0200613E3D69C27FC73F82B35B95589390669D2449ED976EDF635FDB834086ED94C7D0C672FC20F0746773038C6705B8FC30E5F4DD9B16BFB9854B7D59612B2DD287568EF5367CE4E950E32EC794D0D45899761238D92CB5580FAA64DCDCF792360580016B198B35354131EBCDF034C52CF65E4A94767C3966CC69BB03BF5DE41C9C4C09AA081BAA9AF9694F0954E9A833D4060ADE8A64C6AAF7B0636DBBB5ECE45B5E252FE8619D3D6F0D57BAD85FE42EC4B3701D88C30FA3480DB783DD869CED7322C07432B1F67686653BDCB0E2B4DE6ECB191C6404D40E324534ACE9F285D10EDB97F64493DF7FFE8FE1D76FD31D91749EAAAD8686426029C3F4060DBFB5B5C200F8069E1ADA9A0866EFABBC0878000FDC8525400951B7A6BDBD3F88BBE259FA9ED6A0F4448F1FDAF2A17B05A5490AE9652D4401A5C7B936C85A9A723CA41882F947A2E13AD0F918844ECE6C400232B4AC5F732B56EF58C2CC3831836B1F8A3065FFE06402CC8B6AC0F31215803E8425D5EFAB9BF26DAC7B6CDBD76956041777D064C01F4175EBA249676259BD0A887449C393DFC7E2B883F6DF90353F476C7E44DB85026DB2502DB9C2FBF4D121441E091B2120AE22D50A61BF7687F4282CFA02066B2C59156DB4D8003896F4D83D75244424C90EC317D2CB3C43090A028E041B0098A9032BABE95883B1C872A41EE8B4496872B35C1CA642920530C73240158780205479E47142AB08B8B05D444F40C562D261847405409D662036C5D26218745E67D8416A8FEF691F2417A7EDBEDE6F17F041C7920E81291946422609F2AB84D6A4653C56999BEF4A0E2A9FC4FE632DDBEF9F30CD04F017D127CF9D6029160B851C999C99AF012D08170C24167A94D0DC500BE92BD78F8C5DFD5B0FAA9C3E527A6B0F1CF2E4E70F757493F97DE0F5BBDEC34DA70208DB3297FAE466241AEE7EC9A5A4D3778BED6CB16D67EE74F820AE304C6080D8392C833D51988FAACE1475F2D3403B9193E23127B417C4338053633C5F38C5672A31852B909C3EE20DE26C6144F3E18627805B3BCE92E04A0ACEB4147CBFEC49756A2168FC10140E15A0AE96117FCF094B26657BE2568E2EEA9645400B4B2BBF59B28AFC69E6D7F80357F9262C247BB14B24583A6C7BAA991F61F8D8478B0D01F15C3329B4FEB392EDED5D927F135418A563DCBB5E10FFC7B16808E2DF10ACF63558B7779C25A4B66CED882C6FC97B158E8B79EDA6C6A1B4574FB512F5832CB4A7685B843B7FAA293918E2D486D06BA784D28B9D9742DB9B0824AD9D48315DB0D6AED3DA2AD781256E6B0008CFD680E287A331C5AF5AD99642D07419136755B4B4C3C46E39DCAB8E1134B40DD0694F3D9E6BBA022E5F520153BE543365A841312B62B8B65B221D624934B6937E89C30475B139B11A7678AAE0CE920E99F2850353665D5C1CB6665BC957C9F41502EAA504D7A41D934B898C319CD536169F440792EA98874539F29B17325AAB0572A9ECA7693DDC24366374E92C54722E090FC223AF7EDAA5430BA619939E2352CC249328932693D0239E81882C18C6D5702333FC07AE7A661E376D490176E0FF92190B7405E9758D899C2ED31D345A9EDE038BB25647795F4B25861CDF5DC509BB52806030D3FA404B1D6FCDC780D94C8D456AD4E12AD2A03B5604961BC274892205DFD70CE492E528519C2A06E8306935320A2B32E8B6A1C6B20037F25E2051A9CB0417296C3BA5B47F8A4D2CEA822356289090005291E8BE0A2645D82FCA53353EA0DE13A89039448233BB89EC86EF55B1BE048779C635A10A3623EDA459F12E6956C1A26D5B9895620F091FEE66C80A1E5CE9E45F2B6959DD31ED0FB87B30654E0ED91FFC0C647BFD2C50B6359F29DC75D7A4B5F56F862E8B556DFA2D470FE3A24046DB46F6D8FD6020705A6FC61B32B1C8A2CAAF19DC0BC964E83B5205A073CC7212BBCE55DF6837985889BDE30D95B6B522A21ACBF49EB96421CA22A7836F1623BE6236334E76CB264EAEE69D33555836144408323A3C8B63ADC0F0272B89E42624129034E23A11A098284C0B931FF061CAA7CFE23546BF60E02C4BC70C27182039C654EBE4D9F1ACB285590715F77895B8BA5A01B02828C6AF606C43E35ED3A69A7A478AABBBA2ED6BBBBB0B56301A95DC3D3AD762429F074436C2D534B52BF490763D647EEE74F48FE9A4AC37ABA47A7A35685E7E46D09CABF6B23212B0BD88A804C3A32F65C12CE4D907831979790E87B1C806D8E50F210E89470893CCBF89B977C3219D1981EEA69253549E982BC14EF922505C67CC6905647EFE056C623176EACECBBA43086F94CAFAF6503919FAE36C35D9968425F254C869C36F58A14B2986701740CD704BFB29CC884A992C18100D2DB842979ECE8A8F5E8F363F74009AF68FC8436690FBC5BC9C4A73995BB3DAA359493886B5027B990C0951E3019B9BF2F3071CCF42C0CA12268754A314B73E86AC221915A48D1CC7D897FD6D594A59ABE228DEC56547E007D9886AB6022ECA8692705B4502A5A6D4522167CBEFA064C3DF8504E88E7DCC35ADE2A318BEAAB48C1AE871B0C07C8A3D361F20314105A5A8ED58C95F18BB77466694DCB0AC9520178AEE843C13B3D480B232717DC12715D87EEAE7957E8EC8D90063A73BBC0C0D2949C5520BD0C4BE5420C01266041C9A4476B7BAFFC3638DB44A728539198D1F0AB5EBF6C201BC8337AA4F172CC2A549B64C138A238D048A51E6741538206C1B6E995E323C63A24F14D97CF4A2C3EA4F7A90F6EC1569E5A13D3CF3D3532624940C45841D6164223D4B5360B1B431FBFA2A7944C430CAD822728947125110F95F27C9D3BDB999A657A8B856A57EA6ADB2F4140804BED4D623654C590B14F1E86E246D4836ADAA3AB6BDAAC974960E8D4278B0077FEC3CB1BDEDFC2BDAAEA5E1CA071264721F897A645A9E9EB4A35B1F4F30DF12972B65513BDCB70567EEE8A123164ABE81A6632B555F914FA3D2F1328122C16B84AD0A0CBE2D434647708DD56C17F8387FE4CFE5D4684954EFD8695C90E15E4195D5BD6E8614525B764AD62ACF11C045E531A54C9C7526B15FDAC6C0ECA084436AF58397B59CA1AB2CA250AF9F62EF050491A6AB1E9F92CB9F4A19689277B6AC4211F61CDDB2D6B68D0C2F098B29C011144628FDDE1773183153AC6089B06A4D09121B35BDAC0A7A8740948828AC65C96607E4E5FD918A95F5C1CE0400732D03D5D939F3583D3095A0ECD43B5D79499A24AE625FC8E6FB435E71B178F6EFA7A6BAC3F466B9C6616D4FBD5A35D461B9B6AF0F9395A1B4EB78C15DFBB93D3B0E71FBB218D57C77D2C7FED636677E5B9BA5F96646789AAF20AF4AB2D3B86F77F286E33B14184C6416A7FC2015AA84CA966E4952E4506E5A3B08CC783162B8A437A643D2E97FA22A488609082D4ED2B4D0033C214ED4E594DB0B1ADA3A4CD4B382C60C34CD406805FE317B1FB67A0B70C33E2FC350F1A09E94840A1586FC679E3596153BC00892C8E6F700AC5931A4EB4AEB4915591A6508ED189E8CE9BB663CBCC8CC536C2A998AAAA23C0155EF3E787CC21C13CA144299D8ADC00882B74F97922F2AD5BE1D3B6F355D695EF9CB88754327F868E16C606E83156987DCA11AD3DD5A475271AF9C7FD9B99D9F23BDEDD5CDC14C4EA67C0EACC3B64749232A380310A918C3138C1B455AD18B4B3BD1014F336A368297A1854A421BC859A15B67CEAA0404CD41167DF859E52885F6E1C3122A2BFDBC95C3A3A1D0D9B160A92C4D15E1E1372A17FDF4A46D09586E98C1ABBCCAB37BD84DBFAFA6CDC8D9142DAAF19B37A3E5B9D1984475B1EF959B4702ADFA65A4A56D4F430AE5D83C7064A995FEA603718A98B9CA529FD52468DC55C03246E8BB2E0A0FE7591E366DD462F3D7225F4682C41123CE4361829B545FA7B3ABC902D6BE3C3E4246954C83A324B7490FA5295B8B6A4ED484BF06C820D332BA0E76711271971D2C90392A6A3434D69D88A7EA7C3600FCAE1A1841B33389A5B7CEE9228603B29875FD4838CCA8EAFA745130F651CDD5A64AC7B55E3A12BDCCD6B8BF4549A19109B1F26D55E75726C06257E0ABFE5C8D0022CA8DE159169B966CE47D45814D8978C1EB5A382DD5F69FF70D3614303BE430FB4820442F4CEC64DE8ED199D5FE962AD6CC076D0F19E6D23CB7EFCE045774F54E5D6FCA09492B40A44BB333E260785EB3B285FDF1E5C30D2339179D142CFE27D71B1139FBF95868CA4F99F09C42FF61929273F056C89D3541FB05AD4A00046D4F767B684574EC2CF530BE0C09C9F928F2463BAB7C5974EDAACDE63BEDAEA5C6B71D809F50DBFBA72796FF0011934274816E0A17F4BB6306FD576DDD44808F654DB58C941B2469CD9E52B9920776EB31469423EE1E47664306B36F4BE4DE25C1B46F7AAB92C387D659F27630E69DFBEDFD7536ED52F58A87673E5160CB3B96C5A7D5D22804AFC5BE335DFDB9748FF5CFFD8E96A4143525832DAC28B9CE8DEB0F4E19C527287AFDE9F8975B0A04049B42A4184B24032470804F69DAC97DBB6967C56898B0492C008ABD05F7A23DFA96ABF0002B739D2ECB5D763F95C14FCC7690630D42754B7D4FED62B7BD8D5EEFAE75772E4DC9742B25691BA212E59A71646C07F30A5B6E59B6421BC5555A2E0E7DE6872D87918362DA7D57706FDBED172A7D778722F8CCCE9787FF4EC611E0A1F2884C0C179A8189D7AE49E6B0EF4287CF5458122D7168236026D3330BE105C75294C2001E2B2F08273AC9AEDDD9560415845CF682B9A045AC4803E0E2123CCC7D0D749EB41D0721B00419420798191D74F61D224F9C472496C0314A6E81112DFDCA1D71060BACE8B68AB0A9A85A8E2B326CAC0298D294DA0EEFADC74FE63AD0A870BD745D5A001D70BE5DD1B0FE9F56A02F52B12B3D4E05E0BE1AD0CFD28C28402FF946677FD935B496127A6F54C09FA31D951AEC6BC97916B5DB29E5E7A316B10B110075C4697A9DCCE7AEEB387037F3ED6C65983DB8D1A11B7507A801EB5652216BE6B18BF109D7CB5061CE04C21E2C615121BC9D5C60CE075CCB944BA8D374A6EF00345A6D6AAB364B0B389711141E80AAD3B6D4C741C0CBF09C589FEB24BB74B43D53A126FAE106EC3187DB8F433F67DDF1CF0B96832C462CB9DC698A615C4B20A47117F6B57C0E50B5A03BA76CBF76FCA00286AC0997DB48B88FC4CF63E14D82EBE0F3CF29F29297AE7A915FE39404C6564E5F7AB6CB18008F128D61A33A6579206A2B14080B09497FF5582C5CEC7B8D58AAC68949D78B06A7B0C10A8E226B73D521EBE52790C00CDA2831C81747513D8B0AF07CF60CC6E93C3D7502DDA5DF29332F09C7FBA21633E8E146FCE059C71FD1726660BCBF621D8B5EB49D2C4986328E23824C3CFB8EDBE8AA644018DA52F367BD4EAFA5A6F013EA4D2093B9F374EBB22249E2B4EFFA53814491D4B9C36359840A39F7281972E237DB8F190928E2B663971C2FA1409148A0B4F233451F24F06AF686EC87DC3ED38DEC960B59A8B3916C1E8F0439F00C59CAC457F1D35DF709CAEFF9612D7F0A2C9AC9BC12393315C238159172A8D1C32428034E304568682EB3085437B3679115BD3321C00BB9BBC100055E505BE6BC67AC20E1EC1E714489B17BEECD3C214F232E1953A41C796403CCA74BF5449EEB9B0EA52E582DF87407BE3561394BD5978A2D60A16CFFA390A436346C518F530B34271E191E2C51AE49042AC419D13D0C48F2BC67AD1C4419C44B8ECDF231306C96B22D8D2EFE70E87B4B1555B05969C0FA34C1379AB2243E393FE1673932D7E499D3398A25AB48CE77E3B5EBAB949C85C997DA6BD58E6C4BD53376A8941D7BAABF0C3423914399AD1D423B0CD2B1558F1DAB7FE9EE94EBC2F23649E26039B72841DFCD623100E7BB6E323AF4E9204224D2EA2AB93A86E35020E1BA2424132E4018F49A63D450A8E382EF2411898E286A606C745EB2D585B628A80C125B16272BDEA6D11340E5595D97A82C2BC53F681B22E3E3C468589352F806E549FDDBA214DF6BD60A7BED417B468CFB0E00ABC4D068862A169248798228100206892EAA9775A8632E2250A90635A4596C0CBEE402DD65A731A7283C973380A50DD2F87294BBC611A2721F347EE0A4DD6CBE20546AF7D44C8E0973D534810890A70B65D29B24214249EAC6BC0531F0C82D466E04C7A2D931C1B479AD6AAD0A55305642A63C7B8860D442483758F0FA18AF66896A349F2A8A2264C91A46082573691EC9EC7AE272D8C11AF5EDF4BF00BABBE3F26B7433AC3C26F7A42648CCB461E48DBAD216E83AF03DDB66A4DCAE62C101BBE8E483ECF384D97D8D60D14F7EAED5F0DD6687CCE4B607A502D237A4A296774B09FC19BB090E457573B3331D4AADC28EA8BA6BDBB7A74A7D54301AC44AA9FAE101C9B374D1EC6E464A6DAF3BF1D06530F3D8F1CCAE602A2580F1215F70C8A6738488418DAB618578839CC3EB4ED29129AB739FD468F8C2BE00B197103336879B98BB14519B22213C771309E049487DB16E68DEBA7255BF4A802E4C52D90DCE0B250B712BB82C92FEA8A7ECC9E2001E3F9C075A9015B7C8BB407C18CDDED866606FB58FEC03FF40154CE4559AA4971877461BCB16011C8F23E389C7F48FBBD9188C553AF7A3D6DD6999A54CCCE05345CBBFCA498017E414FE5CB2AE4413613A39A4AAE0DA8EFF621B5834E75281BA12C1AECAA13BF568A382BFD76C64B987A4255C75CA38A49C60D8A7AFA22E95CE15F4DC7C15754143DAA733BC0339A4FB2804CBF2A54D9216C5C1A9793975A37BAE402A6C8E7036C15C4778558D442BC35C8AF0ED68EBBECD174ABE6BC54A79A409C992C86E4862D39692CEF42CC46EA0AD171C2A3856CE0E6C9008C4AEB409D6E654A0200BE24D722D66CBDC3F12F75E7D705FE5277462D99A4EADDB2AA68F8B74A6917C5A9690434E145A6EC86BFDC02CC0135B4A05014EA67C646EA3B7E298F2C1AA430445C2432A23CA834F32AC4102A1179D7637E2A10BACB265392A51E32639F1598C0E1B52BDB432F1E7A2394F363D21870D4A1E22B98E6BA8E009842FEBBFC936D019035478FD4C44D2ACF8AE1357FA4AF23F1E9BF3978F858A738E0C4F324838490186EFD156BDD744498A8A3FD49BE3B19BB2D08A062ABC867E2CC73EFD2FD5A462D41E2E6BD86759F74BE92B17A8D9C286E61C44DCBD1B384CFA6C37233318A1EF4CF7FBCB37FFFB1420A25786786C22ADF330493272E1FB69380F75DA62A934D9063E10E0D2522DFB917B7BF2B48CFBA38843F601BCD3964B371E039AB4A448ABB9AEF229C27CEBE265220C5CC0940E0AB0A94F85C77093488694E05793D532EDE9DD5A98E902B2E8DFD1828DF125050B74F18A35F1A783C7940CB6A6F6DFA3CD031F55C4B3EDAB62232FB31737AA7067ABD5E77637ED089B60392131D07CD748D49544C6D39616410221A8B20433A7DC1B6BE7B5381D2CAE80BB926441A3D7016AD13FB2458D80875E3820D4B015E79A051C74BE203031C7C223B08E9F8E8971E26A1F9A317FE97BD96802509E56C0240C104D0552B851BE1BCDACECB847CF529D5652CA6D0DE1E25D0A240F8CA2DEE9CEE2C3F06AB96099BF104979F71FB5B72092DFFD9CF0AD1BFA5284A21B286AF5562F6B17859E97BADF3A86EDF7F07F6DBB4F37B8E4F818D9E96818E3B8F52CD4D1FCC682BBE063CB8055CB0875917526795D1CC5141649B5672D70EC5EFB0BE96400FDB395C3630FC967429EC7819FE174B52BA85AF0C490E3B73F152AF4D15B19D0A276E41AFEE74B4F5C3419EF763352552885D95FD8A87360A2DAB76A612915A2646C542F5335A94CA2DA0DA3E14C6E8519F233B1CE5A1E19F383E8846A1B01331C757C42222075D21C0B41EC5A189C74E60EAE9C110F68166F27B0DFC2A2103BF759DC7D2BAC3A64411AC5A08A2049639CFBD3D38F5E9D612BAE6E98B34158C01A816AF06DEE33A2F121EA109C94CAD32DE0D4052A8AD6E74368F3AE7FADBE5743772DD5F425A6877605C1280A22E80BBDC8218763BE3F668B34140C77ED66ABE4E8F61C1F12562DEA383BC75992DAC61CC1E4855D26F39425CE6E49D4006A93E45013BE4F3504C92BC6EB582714A36AB96F2130B7FD3A73807BF6B04D3198406D688747CC1E4D58318199B1E04B1EF4256658A1DCBC84D4F94E1CAEECF17D327ECEFD2C67D13068D6C6A01C2F06FC642575547B8F5476B38D09F0A50708ADCA101D78A4B9CBA0CBDD364757DC56ED68054DB37F214D97BDE116407C2AE9B5E8954196BFCD61639BF280F0F1753E045FB522AC54279B79F5F6960D7EFDA8285DA63BFD6DDD57BCA4EFC2757C00D252864B8656FBFDB2504260A2C4F2D9165C7026D9FA10DCF0CE4EBA44B1721D3561896384EFDD086D8D808CD8D7E7EA4EB570A4CC62D3EBA3A2DAA42BAC175FBBE3D6221F05F361C3F1D47C24E8C48188754C7F37853BEA4DAA108F99C8F1F6DE6E482F2B3ABCB0BD24747673BBBFC7F0C7CE634046D790514B8CBC68818D72CEB488BDD26097B890F333E51D234005416C28B0AAB920D5C896B76D09333663A43A626C9BAA829831ACFD95A552E847DC4CE0FE32232B63252FB5915728C5DBF5A51C937A7E340CA70C58A8855EFB8A7F9F2A902D1FB5BA4D598CD3F8D07CD637771EAB0F339DEEDA12B39D75D254F7DDC8D232181D63D10A74D1F1D50CEE7229104CEF3B88C98C3B81CF49F7BBB90A6369AB9B55479F8D61393EBB9B7F96CCBEC31C54045643C8A0C36D0AAEA9B6B69CCC15B3127DBE1CD17F1E3DA7C8CB0CA6EA309B9E65FB52FA7C9F58DF1C3DE5AC74A08298AABE1FE22A1AD2AB66A6AC0B30B5915972CCFF499E23F3314B7F64DC70A73B4B4B05C195A2F1A96CC81EEE45DB145959447CD9CB4D648A7AF4EB65977DF98D831F12BED56DEB380E0D0BD4683F5165FD3BC972EE2A9F5893EC4FA56DF4A10E1327E0B5232E78315FAE70A50AC11C111BF893B6C04C7FBF88ECA1DE42B966A34FDDB2D70655840831B911DA925D2AB07936F05049B78F32C94A3EB5AFC93310AC7E31F0C3FFCC711E512C4F7F53673E16E799263C062564616A7C4B0047FBF49D722E8DD9DBB33EB03430CEFE160DC646D107CAE167C6D90B69C5A0EAF23A2F76D8FB2405294929CA237CA9EABD1CB12A1693942C8DA66C9497EB38DC7341CE5125DD7C5D962EB1622EDED89507963880CB83CD728E2E83B2C7F74FC60DAEA5F44D4B7C7C8F5E188116C430EF9FB13C0A15E2851B1EC3C5182D6E6489122EC43B3C8B629289D0DD9305B14DB859E243C4D4B46D59F4BC0BD038E80133B3693332CC88F352090EDC9DDBB6A49F958CEDC6AC06D5C13970B4AEBB01CD7214196FC77CA8BEAD3E468B6B323879DFBE402F82B78E324C16D66D524C3C8FE221F6B8796C28ACFDF0768410D6AC0FF399F2BB729A4CA65C02C8723A515FE5EA758866E9039566FFA34BFC678EA60FA8E8936C547DE7E115CB9E84D79C6AE16CE8DAFAA922C73AE3D6F9BE987FFE5162DAE4686019BA0A5494374548F298B28ACD0ECE41F34476EF9F527B7C9C5D6464F662387D87D6C81101D48709CDB419A5062CF277BA30B399F9D48BFC07F3FD20B7B233314203965CD4F7DAE4981115BC977E07DB53AA6094074463993A8C524DC397D401A6930232ADAE0C4E628D4CD4AF0BD95ACF23F8B0E06CDDBEC5AC1462A83868BD89B086B19C684280A499BB7A257190FC2CC97663476A67C996350FCD68146A6DE91453D4FAFA91C8036D507AB825F68FCE3C57FC64CCF37228106F4894DAF5EFE41453B796D1BC2208DD3CDB3B920B121EF7F6BA6B0F63BAE70533DAD10699E3DB620008320775966FD68B15879BEF648D20DC1F34917EA1575201F49E9509FD2865440D60CBE31B77B12569907D442B5BBA76D3D22C3FBC9F36B34336310F0B132F4B7D4854F0E1E5AA9A535FAAB090D5CCA2FC320ADCDEC71293C9E2F5973E6A3206C5B44DD79694F77AF9FCDB5BED53500D00DE74D9B5DBC4901FB52471A46B73F1CB5845BA0C88B21AEA186031D7C125FBD9911DD7744E5C87E292537D015C7ACF5FAAD6C7507F0CFC9491FDC1E429BE0222B8BB6800E4E0FDFBBAAF298B975597BCA863A7F9DA4B70DDE28729001995475A4C1EBACF645339B33627406A3249D2FA64D82B07EEF54004D0C84B830460FA34AB5CA9B096D58B25EC2A34089FE365461CF892FEAE4C6D93CE47FADEAF9EAF411573F5B3AAB6FFB6DFF3F3B22B94ADF57CDDDB8002D779A841F2BBA46922A0CA46B829FEADBCCB36EB7D9D8703E28731E1FBC4FD055B822F5319D1B195B73ABA0E237ED19DD5179A2FC68852C0629B74E12C562F190039DE94C93A98B28B3355F4BE6B1CBCD6745EC9CC89102A6FE7A06B718711C69A9271E1188B7E7A27DAAC7C62EB91B0739335883B74BFC17B4391E124AF515A304FFBDAAC2CCFB747DB355CA75624E7DEC7C3654237FB1CB2CEFEBBF16C0C2A76E3EEE4031E26C6EBF980E25B4F272B7B9DCD9B81257396305F5340076C8D04F5BD9CD1BD1C73B31E8AB3E271313C6FDCBDF9B36B8895D1C1DC15F5D6E64B046A8D441CB59AEB7F6EB98CBFC6177338998A61A0592B4DF92A35B61DAFFDABBD4A956446B2D055BE11A2BC1C78FF76DA7C39BA7A9CB70A87A24E152028C600449081B13D3108D18D31251DED1E19BC11DBE64498E07615176647533DCB2CF14E1CA8A8B6976F8576F200EA0FD9957401A16492324DC8E7EE9D2725E9B0678F76659EBB090A7CF5B80D38CB424F1CBC0AF90FB42CA93C8AD9AF9AF41A3576C97F347790850175328ACF9E81B97504FDFC7F9BCDD56C';

const Index = () => {
  const zlib = new Zlib(stream).get()
  const blocks = zlib.deflate.blocks.map(x => <Deflate {...x} />)
  return <html>
    <body>
      <h1>How does DEFLATE work</h1>
      <p>
        Deflate is a speficiation set out at RFC 1951. There's a lot of history here, {"that i'll leave to the experts"}. In this specific case,
        we're dealing with DEFLATE with a zlib header. This is one of the options that the zlib library can provide. It is also able to
      </p>
      <p>
        Today, i'll attempt to explain DEFLATE through through use of a few examples. Feel free to change the {"Following switcher"} and
        this page will re-generate to create an explaination for that specific stream.
      </p>
      <p>
        Right now, we're dealing with the following stream
      </p>
      <code>
        {zlib.stream}
      </code>
      <p>
        We'll start by digging in what's right at the start. The ZLIB header.
      </p>
      <ZlibHeader {...zlib.zlibHeader} />
      {blocks}
      <pre>
        {/* {JSON.stringify(zlib, null, 2)} */}
      </pre>
    </body>
  </html>
}

const ZlibHeader = (props) => {

  return <div>
    <p>
      A header is made of a few parts as defined in RFC 1950. The header is to tell us a few things:
    </p>
    <ul>
      <li>The type of compression used</li>
      <li>If there's a pre-set dictionary to use</li>
      <li>The compression level</li>
      <li>A checksum for all of this data</li>
      <li>And a little more about the specifics of the compression</li>
    </ul>
    <p>
      That's a lot of info in a small amount. Lets break it down. The RFC says
    </p>
    <quote>
      <pre>
        {`A zlib stream has the following structure:

  0   1
+---+---+
|CMF|FLG|   (more-->)
+---+---+`}
      </pre>
    </quote>
    <p>
      This is saying that byte 0 outlines what it refers to as <code>CMF</code> while byte 1 outlines <code>FLG</code>.
    </p>
    <h4>CMF</h4>
    <p>
      This byte breaks down in the following way
    </p>
    <quote>
      <pre>
        {`bits 0 to 3  CM     Compression method
bits 4 to 7  CINFO  Compression info`}
      </pre>
    </quote>
    <p>
      Here it's important to understand just how bits are extracted from bytes. Bit 0 can mean either end of a byte depending on the
      semantics of the byte. Therefore as we're now referring to indexes of bytes, we have to define how to extract bits from a byte.
    </p>
    <p>
      The RFC defines the bit order specifically as follows
    </p>
    <quote>
      <pre>
        {`However, a byte considered as
an integer between 0 and 255 does have a most- and least-
significant bit, and since we write numbers with the most-
significant digit on the left, we also write bytes with the most-
significant bit on the left.  In the diagrams below, we number the
bits of a byte so that bit 0 is the least-significant bit, i.e.,
the bits are numbered:

+--------+
|76543210|
+--------+`}
      </pre>
    </quote>
    <p>
      So for a byte referencing the value 200, we would write it as <code>11001000</code>. Bit 0 would be <code>0</code>, bit 7 would be <code>1</code>.
      Keep your wits about you though, this will change.
    </p>
    <p>
      Getting back to CMF, lets look at the flag as a whole {props.compressionInfo.raw + props.compressionMethod.raw}.we find that bits 0 to 3 (the compression method) are {props.compressionMethod.raw}. Which is {props.compressionMethod.val}.
      Bits 4 to 7 (the compression info) are {props.compressionInfo.raw}, which of course is {props.compressionInfo.val}.
    </p>
    <p>
      The second byte is the FLG (Flags). This is outlined as
    </p>
    <ul>
      <li>bits 0 to 4  FCHECK  (check bits for CMF and FLG)</li>
      <li>bit  5       FDICT   (preset dictionary)</li>
      <li>bits 6 to 7  FLEVEL  (compression level)</li>
    </ul>
    <p>
      In our case our values are:
    </p>
    <code>FLEVEL: {props.flags.fLevel.val}</code>
    <p>
      The compression level is outlined as
    </p>
    <quote>
      <pre>
        {`            0 - compressor used fastest algorithm
            1 - compressor used fast algorithm
            2 - compressor used default algorithm
            3 - compressor used maximum compression, slowest algorithm`}
      </pre>
    </quote>
    <code>FDICT: {props.flags.fDict.val}</code>
    <quote>
      <pre>{`If FDICT is set, a DICT dictionary identifier is present
immediately after the FLG byte`}</pre>
    </quote>
    <p>
      At this point, this deflate blog only supports those streams without a preset dict. This is most streams.
    </p>
    <code>FCHECK: {props.flags.fCheck.val}</code>
    <p>
      As this sounds, this is a checksum. We combine it as per the RFC
    </p>
    <quote>
      <pre>{`
       The FCHECK value must be such that CMF and FLG, when viewed as
       a 16-bit unsigned integer stored in MSB order (CMF*256 + FLG),
       is a multiple of 31.`}</pre>
    </quote>
    <p>
      So lets have a look at CMF and FLG together <code>{props.checkHeader.raw}</code>. This corresponds with {props.checkHeader.val}.
      If we divide that by 31, we should get a whole integer. If not, then this is an invalid header.
    </p>
    <p>
      In this case it {props.checkHeader.val % 31 == 0 ? "IS" : "isn't"} a valid header.
    </p>
    {props.compressionMethod.val !== 8 && props.compressionInfo.val !== 7 ? <div>Unfortunately this stream is not supported. Only those with a compression method of 8
      and a compressionInfo of 7 are supported</div> : <ValidHeader {...props} />}
  </div>
}

const ValidHeader = (props) => {
  return <div>
    <p>
      Next in the ZLIB header RFC it specifies that compressed data comes along. In our case, we're dealing with a DEFLATE stream. To do so, we must now
      switch to RFC 1951. This RFC specifies the DEFLATE stream itself.
    </p>
    <p>
      I hope you enjoyed the header we just had. DEFLATE starts with a header of its own. This one is remarkably simple though.
    </p>
    <quote>
      <pre>{`
               Each block of compressed data begins with 3 header bits
               containing the following data:
      
                  first bit       BFINAL
                  next 2 bits     BTYPE`}</pre>
    </quote>
    <p>
      Before we get into this, we have to address the bit packing again. We're in a different RFC, so checking section 3.1.1 we can see that there's a specific
      guidance of how this is packed. This is very important to get right, as unlike the previous ZLIB header we aren't talking about data in bytes at a time,
      and the bits within those bytes. Instead we may be looking at multiple bits over byte boundaries.
    </p>
    <p>
      Here's the relevant part from the RFC, i'd encourage reading it and then we can unpack it.
    </p>
    <quote>
      <pre>{`we describe the compressed block format
         in below, as a sequence of data elements of various bit
         lengths, not a sequence of bytes.  We must therefore specify
         how to pack these data elements into bytes to form the final
         compressed byte sequence:

             * Data elements are packed into bytes in order of
               increasing bit number within the byte, i.e., starting
               with the least-significant bit of the byte.
             * Data elements other than Huffman codes are packed
               starting with the least-significant bit of the data
               element.
             * Huffman codes are packed starting with the most-
               significant bit of the code.
               
         In other words, if one were to print out the compressed data as
         a sequence of bytes, starting with the first byte at the
         *right* margin and proceeding to the *left*, with the most-
         significant bit of each byte on the left as usual, one would be
         able to parse the result from right to left, with fixed-width
         elements in the correct MSB-to-LSB order and Huffman codes in
         bit-reversed order (i.e., with the first bit of the code in the
         relative LSB position).`}</pre>
    </quote>
    <p>
      So, a <definition>data element</definition> is a token in terms of a part of the deflate stream. They're packed into bytes
      from right side to left side. Data elements that aren't the actual huffman codes themselves are turned into
    </p>
    <p>
      TODO: Insert some examples of how we'd pack some parts
    </p>
    <p>
      So, lets get down to business and look at our first deflate block.
    </p>
  </div>
}

const Dynamic = (props) => {
  var compressedAlph = []
  for (var i = 0; i < props.tables.litLenLengths.length; i++) {
    compressedAlph.push(i)
  }
  var lengthAlph = []
  for (var i = 0; i < props.tables.distCodes.length; i++) {
    lengthAlph.push(i)
  }
  return <>
    <p>
      So, we're in a dynamic block. Dynamic blocks basically mean that the huffman trees that are used are defined within this stream.
    </p>
    <p>
      In a Dynamic block, there's 3 huffman trees that need to be identified
    </p>
    <ul>
      <li>A huffman tree that defines how to decompress the next two huffman trees</li>
      <li>A huffman tree that defines the literal/lengths</li>
      <li>A huffman tree that defines the distances back</li>
    </ul>
    <p>
      So to get started, we do need to get some information that'll allow us to read those huffman trees. This information is split into
    </p>
    <ul>
      <li>HLIT - The number of literal length codes (257 - 286)</li>
      <li>HDIST - The number of distance codes (1 - 32)</li>
      <li>HCLEN - The number of code lengths used to define the other huffman codes (4 - 19)</li>
      <li>(HCLEN + 4 * 3) - Number of bits to read to get the first huffman tree to decode the next two</li>
    </ul>
    <p>
      When decoding the 'meta' huffman that encodes the next two trees, we go in with the knowledge that the
      codes are in the order 16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15.
    </p>
    <p>
      That means that the first 3 bits encode the code length for 16, the next three encode the code 17, and so on.
    </p>
    <p>
      But What do these codes correspond to? Lets check the RFC
    </p>
    <pre>{`
               0 - 15: Represent code lengths of 0 - 15
               16: Copy the previous code length 3 - 6 times.
                   The next 2 bits indicate repeat length
                         (0 = 3, ... , 3 = 6)
                      Example:  Codes 8, 16 (+2 bits 11),
                                16 (+2 bits 10) will expand to
                                12 code lengths of 8 (1 + 6 + 5)
               17: Repeat a code length of 0 for 3 - 10 times.
                   (3 bits of length)
               18: Repeat a code length of 0 for 11 - 138 times
                   (7 bits of length)`}</pre>
    <p>
      So, this allows the next huffman tree, that may be as many as 286 codes, so be compressed quite dramatically. Especially
      in the case where a run of literals is not used, and thus 0 is provided as the code length.
    </p>
    <p>
      Without further ado, if we decode (HCLEN + 4 * 3) into code lengths, we get the following huffman tree.
    </p>
    <HuffmanTree alphabet={[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18]} lens={props.tables.bitTable} />
    <p>
      We can now use this tree to read the subsequent {'TODO'} codes to get out literal length alphabet
    </p>
    <HuffmanTree alphabet={compressedAlph} lens={props.tables.litLenLengths}/>
    <p>
      And finally, our distance tree
    </p>
    <HuffmanTree alphabet={lengthAlph} lens={props.tables.distCodes} />
  </>
}

const Deflate = (props) => {
  const blockType = props.header.bType.val
  let next;
  if (blockType == 0) {
    next = <></>
  } else if (blockType == 1) {
    next = <></>
  } else if (blockType == 2) {
    next = <>
      <Dynamic {...props} />
    </>
  } else if (blockType == 3) {
    next = "Invalid block type..."
  }

  return <div>
    <p>
      A deflate block starts by telling us two things, the type, and if it's the last one. Lets start with BTYPE
      which is {props.header.bType.raw}, AKA {props.header.bType.val}. These correspond to the following values:
    </p>
    <ul>
      <li>00 - no compression</li>
      <li>01 - compression with fixed Huffman codes</li>
      <li>10 - compression with dynamic Huffman codes</li>
      <li>11 - reserved (error)</li>
    </ul>
    <p>
      We also find out one other piece of information here. If we're done or not. Lets check out BFINAL. It's
      {props.header.bFinal.val}, that means that after this {props.header.bFinal.val ? "we're done." : "there are some more blocks."}
    </p>
    {next}
  </div>
}

ReactDOM.render(<Index />, document.getElementById('root'));